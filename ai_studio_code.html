<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Marketing Pass</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        .pass-gradient {
            background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
        }
    </style>
</head>
<body class="bg-slate-900 flex items-center justify-center min-h-screen p-4 font-sans text-white">

    <!-- Digital Pass UI -->
    <div id="pass" class="w-full max-w-sm rounded-3xl overflow-hidden pass-gradient shadow-2xl relative transition-transform duration-500 hover:scale-[1.02]">
        <div class="p-6">
            <div class="flex justify-between items-center mb-10">
                <span class="text-xs font-bold uppercase tracking-widest opacity-80">VIP Marketing Pass</span>
                <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">üéÅ</div>
            </div>
            
            <h1 class="text-3xl font-bold mb-2">Exclusive Offer</h1>
            <p class="text-sm opacity-90 mb-8">Unlock premium access and 50% discount on all digital services.</p>

            <div class="glass-card rounded-2xl p-4 mb-6">
                <div class="flex justify-between text-xs opacity-70 mb-1">
                    <span>MEMBER NAME</span>
                    <span>EXPIRES</span>
                </div>
                <div class="flex justify-between font-mono text-sm tracking-tighter">
                    <span>EARLY ADOPTER</span>
                    <span>12/2026</span>
                </div>
            </div>

            <!-- UPI Payment Button -->
            <button id="upiBtn" class="w-full bg-white text-indigo-600 font-bold py-4 rounded-xl shadow-lg active:scale-95 transition-all">
                Pay ‚Çπ100 via UPI
            </button>
        </div>
        
        <!-- Bottom Section for A2HS Info -->
        <div class="bg-black/20 p-4 text-center text-[10px] uppercase tracking-widest opacity-60">
            Save to Home Screen for Instant Updates
        </div>
    </div>

    <!-- Firebase Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp, setDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getMessaging, getToken } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging.js";

        // 1. REPLACE WITH YOUR FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const messaging = getMessaging(app);

        // 2. Track View Event
        const trackEvent = async (type, metadata = {}) => {
            try {
                await addDoc(collection(db, "analytics"), {
                    event: type,
                    timestamp: serverTimestamp(),
                    isPWA: window.matchMedia('(display-mode: standalone)').matches,
                    ...metadata
                });
            } catch (e) { console.error("Error tracking:", e); }
        };

        window.addEventListener('load', () => trackEvent('View'));

        // 3. UPI Button Logic
        const upiBtn = document.getElementById('upiBtn');
        upiBtn.addEventListener('click', async () => {
            const upiUrl = "upi://pay?pa=YOUR_ID@upi&pn=BrandName&am=100&tn=MarketingPass";
            
            // Track Click
            await trackEvent('UPI_Click', { amount: 100 });
            
            // Trigger Deep Link
            window.location.href = upiUrl;
        });

        // 4. PWA Registration & FCM Token
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('firebase-messaging-sw.js')
            .then(async (registration) => {
                console.log('SW Registered');
                
                // Request Notification Permission & Get Token
                try {
                    const currentToken = await getToken(messaging, {
                        vapidKey: 'YOUR_PUBLIC_VAPID_KEY', // Get this from Firebase Console -> Cloud Messaging
                        serviceWorkerRegistration: registration
                    });

                    if (currentToken) {
                        // Save subscriber to Firestore
                        await setDoc(doc(db, "subscribers", currentToken), {
                            token: currentToken,
                            lastActive: serverTimestamp()
                        });
                        console.log("Token saved:", currentToken);
                    }
                } catch (err) {
                    console.log('Token retrieval failed', err);
                }
            });
        }
    </script>
</body>
</html>